<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --border: #30363d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --text-muted: #656d76;
            --accent: #238636;
            --accent-hover: #2ea043;
            --danger: #da3633;
            --danger-hover: #f85149;
            --warning: #d29922;
            --info: #1f6feb;
            --success: #238636;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--info) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            box-shadow: var(--shadow-sm);
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 0.75rem 1.25rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .nav-btn.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 10px rgba(35, 134, 54, 0.3);
        }

        .page-content {
            display: none; /* Hidden by default */
            padding: 1.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
        }

        .page-content.active {
            display: block;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
            background: var(--bg-tertiary);
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: var(--accent);
            background: rgba(35, 134, 54, 0.1);
        }

        .file-input {
            display: none;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 6px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            gap: 0.5rem;
            background: transparent;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-danger {
            background: transparent;
            color: var(--danger);
            border-color: var(--danger);
        }

        .btn-danger:hover {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
        }

        .input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.875rem;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: border-color 0.2s ease;
            margin-bottom: 1rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(35, 134, 54, 0.2);
        }

        .input::placeholder {
            color: var(--text-muted);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--bg-secondary);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.875rem;
            border-bottom: 1px solid var(--border);
        }

        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
            color: var(--text-primary);
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover {
            background: rgba(35, 134, 54, 0.05);
        }

        .status {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-running {
            background: rgba(35, 134, 54, 0.2);
            color: var(--success);
        }

        .status-completed {
            background: rgba(31, 111, 235, 0.2);
            color: var(--info);
        }

        .status-error {
            background: rgba(218, 54, 51, 0.2);
            color: var(--danger);
        }

        .status-killed {
            background: rgba(139, 148, 158, 0.2);
            color: var(--text-secondary);
        }

        .logs-content {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            color: var(--text-primary);
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
        }

        .toast {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--shadow);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 400px;
            min-width: 300px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 3px solid var(--success);
        }

        .toast.error {
            border-left: 3px solid var(--danger);
        }

        .toast.warning {
            border-left: 3px solid var(--warning);
        }

        .toast.info {
            border-left: 3px solid var(--info);
        }

        .refresh-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: auto;
        }

        .refresh-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .file-icon {
            font-size: 1.2rem;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            border: 1px solid var(--border);
            word-break: break-all; /* Ensure long commands wrap */
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .nav-bar {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
            
            .nav-btn {
                width: 100%;
                text-align: center;
            }

            .actions {
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .btn-sm {
                width: 100%;
            }
        }

        .command-output {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            display: none;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Server Manager</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏</p>
        </header>

        <nav class="nav-bar">
            <button class="nav-btn active" onclick="showPage('upload-page')">–ó–∞–≥—Ä—É–∑–∫–∞</button>
            <button class="nav-btn" onclick="showPage('command-page')">–ö–æ–º–∞–Ω–¥—ã</button>
            <button class="nav-btn" onclick="showPage('files-page')">–§–∞–π–ª—ã</button>
            <button class="nav-btn" onclick="showPage('processes-page')">–ü—Ä–æ—Ü–µ—Å—Å—ã</button>
            <button class="nav-btn" onclick="showPage('logs-page')">–õ–æ–≥–∏</button>
        </nav>

        <div id="upload-page" class="page-content active">
            <div class="card-header">
                <h2 class="card-title">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h2>
            </div>
            
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div style="font-size: 2rem; margin-bottom: 0.5rem;">üìÅ</div>
                <p style="font-weight: 500; margin-bottom: 0.25rem;">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã</p>
                <p style="font-size: 0.875rem; color: var(--text-muted);">–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞</p>
                <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">
                    .py, .js, .sh, .bat, .txt, .exe
                </p>
            </div>
            
            <input type="file" id="fileInput" class="file-input" multiple accept=".py,.js,.sh,.bat,.txt,.exe">
            <button class="btn btn-primary" style="width: 100%;" onclick="uploadFiles()">
                –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã
            </button>
        </div>

        <div id="command-page" class="page-content">
            <div class="card-header">
                <h2 class="card-title">–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥</h2>
            </div>
            
            <input type="text" id="commandInput" class="input" 
                   placeholder="python script.py">
            
            <button class="btn btn-primary" style="width: 100%;" onclick="executeCommand()" id="executeBtn">
                –í—ã–ø–æ–ª–Ω–∏—Ç—å
            </button>
            
            <div class="command-output" id="commandOutput"></div>
        </div>

        <div id="files-page" class="page-content">
            <div class="card-header">
                <h2 class="card-title">–§–∞–π–ª—ã</h2>
                <button class="refresh-btn" onclick="loadFiles()">‚Üª</button>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>–§–∞–π–ª</th>
                            <th>–†–∞–∑–º–µ—Ä</th>
                            <th>–ò–∑–º–µ–Ω–µ–Ω</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="filesList">
                        <tr>
                            <td colspan="4" class="empty-state">
                                –§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="processes-page" class="page-content">
            <div class="card-header">
                <h2 class="card-title">–ü—Ä–æ—Ü–µ—Å—Å—ã</h2>
                <button class="refresh-btn" onclick="loadProcesses()">‚Üª</button>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>–ö–æ–º–∞–Ω–¥–∞</th>
                            <th>–ó–∞–ø—É—â–µ–Ω</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="processesList">
                        <tr>
                            <td colspan="4" class="empty-state">
                                –ù–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="logs-page" class="page-content">
            <div class="card-header">
                <h2 class="card-title">–õ–æ–≥–∏</h2>
            </div>
            
            <div class="logs-content" id="logsContainer">
–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
            </div>
        </div>
    </div>

    <script>
        let lastViewedProcessId = null;

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="font-weight: 600; font-size: 0.875rem; margin-bottom: 0.25rem;">
                    ${getToastTitle(type)}
                </div>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">
                    ${message}
                </div>
            `;
            
            document.body.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        function getToastTitle(type) {
            const titles = {
                success: '–£—Å–ø–µ—à–Ω–æ',
                error: '–û—à–∏–±–∫–∞',
                warning: '–í–Ω–∏–º–∞–Ω–∏–µ',
                info: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'
            };
            return titles[type] || titles.info;
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(pageId).classList.add('active');
            document.querySelector(`.nav-btn[onclick="showPage('${pageId}')"]`).classList.add('active');

            // Load data specific to the page when it becomes active
            if (pageId === 'files-page') {
                loadFiles();
            } else if (pageId === 'processes-page') {
                loadProcesses();
            } else if (pageId === 'logs-page' && lastViewedProcessId) {
                viewLogs(lastViewedProcessId);
            }
        }

        const uploadArea = document.querySelector('.upload-area');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            fileInput.files = e.dataTransfer.files;
            uploadFiles();
        });

        async function uploadFiles() {
            const files = fileInput.files;
            
            if (files.length === 0) {
                showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏', 'warning');
                return;
            }

            for (let file of files) {
                const formData = new FormData();
                formData.append('file', file);

                try {
                    const response = await fetch('/upload', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();
                    
                    if (response.ok) {
                        showToast(result.message, 'success');
                    } else {
                        showToast(result.error, 'error');
                    }
                } catch (error) {
                    showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
                }
            }
            
            fileInput.value = '';
            // No need to load files here, as it will be loaded when the files page is active
        }

        async function executeCommand() {
            const command = document.getElementById('commandInput').value.trim();
            const btn = document.getElementById('executeBtn');
            const output = document.getElementById('commandOutput');
            
            if (!command) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É', 'warning');
                return;
            }

            btn.innerHTML = '<span class="spinner"></span> –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...';
            btn.disabled = true;
            output.style.display = 'block';
            output.textContent = '–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞...\n';

            try {
                const response = await fetch('/execute', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({command})
                });
                const result = await response.json();
                
                if (response.ok) {
                    showToast('–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—â–µ–Ω–∞', 'success');
                    document.getElementById('commandInput').value = '';
                    
                    // Give server time to process and write logs
                    setTimeout(async () => {
                        try {
                            const logsResponse = await fetch(`/logs/${result.process_id}`);
                            const logs = await logsResponse.json();
                            
                            if (logsResponse.ok) {
                                let outputText = `–ö–æ–º–∞–Ω–¥–∞: ${logs.command}\n`;
                                outputText += `–ö–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞: ${logs.return_code !== undefined ? logs.return_code : '–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è'}\n\n`;
                                
                                if (logs.stdout) {
                                    outputText += 'STDOUT:\n' + logs.stdout + '\n';
                                }
                                if (logs.stderr) {
                                    outputText += '\nSTDERR:\n' + logs.stderr + '\n';
                                }
                                if (logs.error) {
                                    outputText += '\nERROR:\n' + logs.error + '\n';
                                }
                                
                                output.textContent = outputText;
                            } else {
                                output.textContent += `\n–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: ${logs.error}`;
                            }
                        } catch (e) {
                            output.textContent += '\n–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: ' + e.message;
                        }
                    }, 2000); // Wait 2 seconds before trying to fetch logs
                    
                    loadProcesses(); // Refresh processes list
                } else {
                    showToast(result.error, 'error');
                    output.textContent = '–û—à–∏–±–∫–∞: ' + result.error;
                }
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ' + error.message, 'error');
                output.textContent = '–û—à–∏–±–∫–∞: ' + error.message;
            } finally {
                btn.innerHTML = '–í—ã–ø–æ–ª–Ω–∏—Ç—å';
                btn.disabled = false;
            }
        }

        async function runFile(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            let command = '';
            
            switch(ext) {
                case 'py':
                    command = `python ${filename}`;
                    break;
                case 'js':
                    command = `node ${filename}`;
                    break;
                case 'sh':
                    command = `bash ${filename}`;
                    break;
                case 'bat':
                    command = filename; // For .bat files, usually just the filename is enough on Windows
                    break;
                case 'exe':
                    command = `./${filename}`; // For .exe, relative path might be needed
                    break;
                default:
                    showToast('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞', 'warning');
                    return;
            }
            
            document.getElementById('commandInput').value = command;
            showPage('command-page'); // Switch to command page
            // Execute command automatically after switching page
            setTimeout(() => executeCommand(), 100); 
        }

        async function loadFiles() {
            try {
                const response = await fetch('/files');
                const files = await response.json();
                
                const tbody = document.getElementById('filesList');
                
                if (files.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4" class="empty-state">–§–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = '';
                files.forEach(file => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="file-info">
                                <span class="file-icon">${getFileIcon(file.name)}</span>
                                <span>${file.name}</span>
                            </div>
                        </td>
                        <td>${formatBytes(file.size)}</td>
                        <td>${file.modified}</td>
                        <td>
                            <div class="actions">
                                <button class="btn btn-secondary btn-sm" onclick="runFile('${file.name}')" title="–ó–∞–ø—É—Å—Ç–∏—Ç—å">
                                    ‚ñ∂
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="deleteFile('${file.name}')" title="–£–¥–∞–ª–∏—Ç—å">
                                    √ó
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤: ' + error.message, 'error');
            }
        }

        async function loadProcesses() {
            try {
                const response = await fetch('/processes');
                const processes = await response.json();
                
                const tbody = document.getElementById('processesList');
                
                if (processes.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="4" class="empty-state">–ù–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–≤</td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = '';
                processes.forEach(process => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div class="mono">${process.command}</div>
                        </td>
                        <td>${process.start_time}</td>
                        <td><span class="status status-${process.status}">${getStatusText(process.status)}</span></td>
                        <td>
                            <div class="actions">
                                <button class="btn btn-secondary btn-sm" onclick="viewLogsAndSwitch('${process.id}')" title="–õ–æ–≥–∏">
                                    üìã
                                </button>
                                ${process.status === 'running' ? 
                                    `<button class="btn btn-danger btn-sm" onclick="killProcess('${process.id}')" title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å">‚èπ</button>` : ''
                                }
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: ' + error.message, 'error');
            }
        }

        async function deleteFile(filename) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å "${filename}"?`)) return;
            
            try {
                const response = await fetch(`/delete/${filename}`, {method: 'DELETE'});
                const result = await response.json();
                
                if (response.ok) {
                    showToast(result.message, 'success');
                    loadFiles(); // Refresh files list on current page
                } else {
                    showToast(result.error, 'error');
                }
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        async function killProcess(processId) {
            if (!confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å?')) return;
            
            try {
                const response = await fetch(`/kill/${processId}`, {method: 'POST'});
                const result = await response.json();
                
                showToast(result.message, response.ok ? 'success' : 'error');
                loadProcesses(); // Refresh processes list on current page
            } catch (error) {
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: ' + error.message, 'error');
            }
        }

        async function viewLogs(processId) {
            lastViewedProcessId = processId;
            try {
                const response = await fetch(`/logs/${processId}`);
                const logs = await response.json();
                
                const container = document.getElementById('logsContainer');
                if (response.ok) {
                    let logContent = `–ö–æ–º–∞–Ω–¥–∞: ${logs.command}\n`;
                    logContent += `–ó–∞–ø—É—Å–∫: ${logs.start_time}\n`;
                    if (logs.end_time) logContent += `–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ: ${logs.end_time}\n`;
                    if (logs.return_code !== undefined) logContent += `–ö–æ–¥: ${logs.return_code}\n`;
                    logContent += '\n' + '‚îÄ'.repeat(50) + '\n\n';
                    
                    if (logs.stdout) {
                        logContent += 'STDOUT:\n' + logs.stdout + '\n\n';
                    }
                    if (logs.stderr) {
                        logContent += 'STDERR:\n' + logs.stderr + '\n\n';
                    }
                    if (logs.error) {
                        logContent += 'ERROR:\n' + logs.error + '\n\n';
                    }
                    
                    container.textContent = logContent;
                } else {
                    container.textContent = `–û—à–∏–±–∫–∞: ${logs.error}`;
                }
            } catch (error) {
                document.getElementById('logsContainer').textContent = 
                    `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`;
            }
        }

        function viewLogsAndSwitch(processId) {
            viewLogs(processId);
            showPage('logs-page');
        }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const icons = {
                'py': 'üêç',
                'js': 'üü®',
                'sh': 'üêö',
                'bat': '‚ö°',
                'txt': 'üìÑ',
                'exe': '‚öôÔ∏è'
            };
            return icons[ext] || 'üìÑ';
        }

        function getStatusText(status) {
            const statusTexts = {
                'running': '–†–∞–±–æ—Ç–∞–µ—Ç',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω',
                'error': '–û—à–∏–±–∫–∞',
                'killed': '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω'
            };
            return statusTexts[status] || status;
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        document.getElementById('commandInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                executeCommand();
            }
        });

        // Initialize by showing the first page
        showPage('upload-page');
        
        // Auto-refresh processes when on the processes page
        setInterval(() => {
            if (document.getElementById('processes-page').classList.contains('active')) {
                loadProcesses();
            }
        }, 5000);
    </script>
</body>
</html> 